<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.quantom.audition.dao.ActingRoleDao">
	
	<select id="getActingRoleById" resultType="ActingRole">
		SELECT *
		FROM
		actingRole
		WHERE
		id = #{id}
	</select>
	
	<select id="getActingRolesForPrintListByArtworkId" resultType="ActingRole">
		SELECT *
		FROM
		actingRole
		WHERE
		artworkId = #{artworkId}
	</select>

	<select id="getForPrintActingRoleById" resultMap="actingRole">
		SELECT ACR.*,
		ARW.name AS
		extra__artworkName,
		ARW.directorName AS extra__directorName
		FROM
		actingRole AS
		ACR
		INNER JOIN artwork AS ARW
		ON ACR.artworkId = ARW.id
		WHERE ACR.id = #{id}
	</select>
	
	<select id="getActingRoleForPrintDetailById" resultMap="actingRoleForList">
		 <![CDATA[
		SELECT ACR.*,
		ACRF.id AS
		actingRole__id,
		ACRF.updateDate AS actingRole__updateDate,
		ACRF.relTypeCode
		AS actingRole__relTypeCode,
		ACRF.fileExt AS
		actingRole__fileExt,
		ACRF.typeCode AS
		actingRole__typeCode,
		ACRF.fileDir AS actingRole__fileDir,
		MF.id AS
		member__id,
		MF.updateDate AS member__updateDate,
		MF.relTypeCode AS member__relTypeCode,
		MF.fileExt AS
		member__fileExt,
		MF.fileDir AS member__fileDir,
		ARW.name AS
		artwork__name,
		ARW.genre AS
		artwork__genre,
		ARW.directorName AS artwork__directorName,
		M.id AS writer__id,
		M.authority AS writer__authority
		FROM
		actingRole AS
		ACR
		LEFT OUTER
		JOIN artwork AS ARW
		ON ACR.artworkId = ARW.id
		LEFT OUTER
		JOIN member
		AS M
		ON ARW.memberId = M.id
		LEFT OUTER
		JOIN file
		AS ACRF
		ON ACR.id = ACRF.relId
		AND ACRF.relTypeCode = "actingRole"
		LEFT OUTER
		JOIN file MF
		ON ARW.memberId =
		MF.relId
		AND
		MF.relTypeCode = "member"
		WHERE ACR.id = #{id}
		]]>
	</select>

	<select id="getActingRolesForPrintList" resultMap="actingRoleForList">
		SELECT ACR.*,
		ACRF.id AS
		actingRole__id,
		ACRF.updateDate AS actingRole__updateDate,
		ACRF.relTypeCode
		AS actingRole__relTypeCode,
		ACRF.fileExt AS
		actingRole__fileExt,
		ACRF.typeCode AS
		actingRole__typeCode,
		ACRF.fileDir AS actingRole__fileDir,
		MF.id AS
		member__id,
		MF.updateDate AS member__updateDate,
		MF.relTypeCode AS member__relTypeCode,
		MF.fileExt AS
		member__fileExt,
		MF.fileDir AS member__fileDir,
		ARW.name AS
		artwork__name,
		ARW.genre AS
		artwork__genre,
		ARW.directorName AS artwork__directorName,
		M.id AS writer__id,
		M.authority AS writer__authority
		FROM
		actingRole AS
		ACR
		LEFT OUTER
		JOIN artwork AS ARW
		ON ACR.artworkId = ARW.id
		LEFT OUTER
		JOIN member
		AS M
		ON ARW.memberId = M.id
		LEFT OUTER
		JOIN file
		AS ACRF
		ON ACR.id = ACRF.relId
		AND ACRF.relTypeCode = "actingRole"
		<if test="typeCode != null and typeCode != '' ">
		AND ACRF.typeCode = #{typeCode}
		</if>
		LEFT OUTER
		JOIN file MF
		ON ARW.memberId =
		MF.relId
		AND
		MF.relTypeCode = "member"
		
	</select>

	<insert id="write" useGeneratedKeys="true" keyProperty="id">
		INSERT
		INTO actingRole
		SET regDate = NOW(),
		updateDate = NOW(),
		startDate = #{startDate},
		endDate = #{endDate},
		artworkId = #{artworkId},
		thumbnailStatus = #{thumbnailStatus},
		name = #{name},
		pay = #{pay},
		age = #{age},
		gender = #{gender},
		job = #{job},
		feature = #{feature},
		region = #{region},
		schedule = #{schedule},
		shotAngle = #{shotAngle},
		scriptStatus = #{scriptStatus},
		guideVideoUrl = #{guideVideoUrl},
		shootingsCount = #{shootingsCount}
	</insert>

	<delete id="delete">
		DELETE FROM actingRole WHERE id = #{id}
	</delete>

	<update id="modify">
		UPDATE actingRole
		<set>
			updateDate = NOW(),
			<if test="artworkId != null">
				artworkId = #{artworkId},
			</if>

			<if test="name != null">
				name = #{name},
			</if>

			<if test="age != null">
				age = #{age},
			</if>

			<if test="gender != null">
				gender = #{gender},
			</if>

			<if test="character != null">
				`character` = #{character},
			</if>

			<if test="scenesCount != null">
				scenesCount = #{scenesCount},
			</if>

			<if test="scriptStatus != null">
				scriptStatus = #{scriptStatus},
			</if>

			<if test="auditionStatus != null">
				auditionStatus = #{auditionStatus},
			</if>

			<if test="shootingsCount != null">
				shootingsCount = #{shootingsCount},
			</if>

			<if test="etc != null">
				etc = #{etc}
			</if>
		</set>
		WHERE id = #{id}
	</update>
	
	<resultMap type="ActingRole" id="actingRole">
		<id property="id" column="id" />
		<id property="regDate" column="regDate" />
		<id property="updateDate" column="updateDate" />
		<id property="startDate" column="startDate" />
		<id property="endDate" column="endDate" />
		<id property="artworkId" column="artworkId" />
		<id property="thumbnailStatus" column="thumbnailStatus" />
		<id property="name" column="name" />
		<id property="pay" column="pay" />
		<id property="age" column="age" />
		<id property="gender" column="gender" />
		<id property="job" column="job" />
		<id property="feature" column="feature" />
		<id property="region" column="region" />
		<id property="schedule" column="schedule" />
		<id property="shotAngle" column="shotAngle" />
		<id property="guideVideoUrl" column="guideVideoUrl" />
		<id property="scriptStatus" column="scriptStatus" />
		<id property="shootingsCount" column="shootingsCount" />
	</resultMap>

	<resultMap type="ActingRole" id="actingRoleWithArtork" extends="actingRole">
		<association property="extra" javaType="map">
			<id property="directorName" column="artwork__directorName" />
			<id property="genre" column="artwork__genre" />
			<id property="name" column="artwork__name" />
		</association>
	</resultMap>
	
	<resultMap type="ActingRole" id="actingRoleForList" extends="actingRole">
		<association property="extra" javaType="map">
			<id property="directorName" column="artwork__directorName" />
			<id property="artworkGenre" column="artwork__genre" />
			<id property="artworkName" column="artwork__name" />
			<id property="fileIdForMember" column="member__id" />
			<id property="fileUpdateDateForMember" column="member__updateDate" />
			<id property="fileRelTypeCodeForMember" column="member__relTypeCode" />
			<id property="fileExtForMember" column="member__fileExt" />
			<id property="fileDirForMember" column="member__fileDir" />
			<id property="writerId" column="writer__id" />
			<id property="writerAuthority" column="writer__authority" />
		</association>
		<collection property="files" resultMap="files" ofType="File" columnPrefix="actingRole__"/>
	</resultMap>
	
  	<resultMap id="files" type="File">
			<id property="id" column="id" />
			<id property="updateDate" column="updateDate" />
			<id property="relTypeCode" column="relTypeCode" />
			<id property="typeCode" column="typeCode" />
			<id property="fileExt" column="fileExt" />
			<id property="fileDir" column="fileDir" />
	</resultMap>
	
</mapper>